{"title":"基于51单片机的C语言延时函数底层原理","uid":"4017b0859f618ced4ab82641491736f2","slug":"基于51单片机的C语言延时函数","date":"2024-03-12T08:29:26.000Z","updated":"2024-03-15T03:08:08.910Z","comments":true,"path":"api/articles/基于51单片机的C语言延时函数.json","keywords":null,"cover":null,"content":"<h1 id=\"延时函数\"><a href=\"#延时函数\" class=\"headerlink\" title=\"延时函数\"></a>延时函数</h1><p>在单片机运行的代码中，由于我们计算机的速度是很快的，执行每一条代码的速度也是很快的，也就仅有几微秒而已，是我们肉眼观察不到的。根据开发者的需求，有时候我们需要代码执行后等待一定时间，再去执行下一条，这个时候我们需要用到延时函数。</p>\n<p>最简单的延时函数是让CPU处于跑空的状态，就是利用while循环来跑空，等while跑完在进行下一条。</p>\n<p>需要注意的是，对于不同晶振的频率不同，程序的延时时间是不同的</p>\n<h2 id=\"周期\"><a href=\"#周期\" class=\"headerlink\" title=\"周期\"></a>周期</h2><h3 id=\"时钟周期\"><a href=\"#时钟周期\" class=\"headerlink\" title=\"时钟周期\"></a>时钟周期</h3><p>时钟周期也称为震荡周期，定义为时钟脉冲的倒数，也就是晶振频率的倒数。</p>\n<p>在51单片机中，一个时钟周期定义为一个节拍（用P表示），2个节拍定义为状态周期（用S表示）。</p>\n<p><strong>时钟周期是单片机中的最小时间单位</strong></p>\n<p>例：12Mhz晶振的单片机，时钟周期&#x3D;震荡周期&#x3D;1&#x2F;12微秒。</p>\n<h3 id=\"状态周期\"><a href=\"#状态周期\" class=\"headerlink\" title=\"状态周期\"></a>状态周期</h3><p>每个状态周期的为时钟周期的两倍，也就是刚刚上面说过的两个节拍，一个状态周期可以完成一个或者多个微操作。</p>\n<h3 id=\"指令周期\"><a href=\"#指令周期\" class=\"headerlink\" title=\"指令周期\"></a>指令周期</h3><p>指执行一条指令所需要的时间，通常，指令周期可分为单周期指令和双周期指令，包含一个<strong>机器周期</strong>的指令成为单周期指令，包含两个<strong>机器周期</strong>的指令成为双周期指令，同理，还有四周期指令等。</p>\n<h3 id=\"机器周期\"><a href=\"#机器周期\" class=\"headerlink\" title=\"机器周期\"></a>机器周期</h3><p>机器周期被定义为是完成一项基本操作所需要的时间。在计算机中，为了方便管理，把一条指令的执行过程分为若干个阶段，每个阶段去执行一项基本操作如：取指令，存储器读，存储器写等。</p>\n<p>在51单片机中，一个机器周期由6个状态周期组成，也就是12个时钟周期：12×1&#x2F;12us&#x3D;1us</p>\n<p>定义机器周期是因为时钟周期的时间太短，根本做不了什么。</p>\n<hr>\n<ul>\n<li><p>根据上述定义，我们可以得到以下关系：</p>\n</li>\n<li><ul>\n<li>1个振荡周期&#x3D;1个时钟周期</li>\n<li>1个状态周期&#x3D;2个时钟周期</li>\n<li>1个机器周期&#x3D;6个状态周期&#x3D;12个时钟周期</li>\n<li>1个指令周期&#x3D;N个机器周期&#x3D;6N个状态周期&#x3D;12N个时钟周期</li>\n</ul>\n</li>\n</ul>\n<p>例如：外接晶振为 12MHz 时，51 单片机相关周期的具体值为： 时钟周期（振荡周期）&#x3D;1&#x2F;12us; 状态周期&#x3D;1&#x2F;6us; 机器周期&#x3D;1us; 指令周期&#x3D;1~4us</p>\n<hr>\n<p>对于我们关注的12T，1T单片机等等是指一个机器周期所需要的时钟周期数目，我们所学习的STC89C51系列单片机有两种模式，一种是12T模式，每12个时钟+1,与传统8051相同，另外一种是6T模式，每6个时钟加1，速度是传统8051的两倍。</p>\n<h2 id=\"对于程序取值的理解\"><a href=\"#对于程序取值的理解\" class=\"headerlink\" title=\"对于程序取值的理解\"></a>对于程序取值的理解</h2><h3 id=\"利用for语句\"><a href=\"#利用for语句\" class=\"headerlink\" title=\"利用for语句\"></a>利用for语句</h3><div class=\"language-c\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">c</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #292D3E\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">i</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\">i</span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F78C6C\">255</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\">i</span><span style=\"color: #89DDFF\">++)&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    x</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span></code></pre></div><p>对于以上程序，这里x&#x3D;2是一个指令周期，执行了255次，我们这里以12Mhz的晶振为例，则我们的一个指令周期为12个时钟周期，也就是1&#x2F;12×12us也就是1us，所以以上程序就是延时0.255ms。</p>\n<div class=\"language-c\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">c</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #292D3E\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">void</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">Delay10ms</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #C792EA\">unsigned</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">char</span><span style=\"color: #F07178\"> i</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\">j</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\">k</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178\">i</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">5</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #F07178\">i</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #F07178\">i</span><span style=\"color: #89DDFF\">--)</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">        </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178\">j</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #F07178\">j</span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F78C6C\">4</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #F07178\">j</span><span style=\"color: #89DDFF\">++)</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">        </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">            </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178\">k</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #F07178\">k</span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #F78C6C\">248</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #F07178\">k</span><span style=\"color: #89DDFF\">++)</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">        </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span></code></pre></div><p>再来看上面程序，这大概是一个延时10ms的延时函数，但是通过了3层for循环的时间间隔，根据计算，循环次数&#x3D;5×4×248&#x3D;4960，又因为每次循环都有两次循环判断条件（i&gt;0和i++）所以每次循环消耗两个机器周期，所以总共耗费机器周期4960×2&#x3D;9920，对于12Mhz的晶振频率，一个机器周期为1us，所以9920个机器周期就为9.92ms，加上赋值等耗费的时间大约为10ms。</p>\n<h3 id=\"while和do-while\"><a href=\"#while和do-while\" class=\"headerlink\" title=\"while和do-while\"></a>while和do-while</h3><div class=\"language-c\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">c</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #292D3E\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">while</span><span style=\"color: #89DDFF\">(--</span><span style=\"color: #BABED8\">x</span><span style=\"color: #89DDFF\">);</span><span style=\"color: #676E95; font-style: italic\">//2×x-1us</span></span></code></pre></div><p>如果条件成立，执行一次空语句，如果条件不成立，则执行下一条指令，对于以上程序，每次循环包括一次判断和一次运算两次指令，即两个指令周期（2us），最后一次仅有判断，则程序延时时间为：2×x-1us</p>\n<div class=\"language-c\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">c</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #292D3E\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">do</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF; font-style: italic\">while</span><span style=\"color: #89DDFF\">(--</span><span style=\"color: #F07178\">i</span><span style=\"color: #89DDFF\">);</span><span style=\"color: #676E95; font-style: italic\">//(2×i-1us)</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #89DDFF; font-style: italic\">while</span><span style=\"color: #89DDFF\">(--</span><span style=\"color: #BABED8\">j</span><span style=\"color: #89DDFF\">);</span><span style=\"color: #676E95; font-style: italic\">//(2×j-1us)</span></span></code></pre></div><p>先执行花括号里面的程序：while和空程序，do执行一次占用1us（1个指令周期）执行花括号之外的while如果为假则不执行（所以要-1）</p>\n<div class=\"language-c\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">c</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #292D3E\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">void</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">Delay519us</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #676E95; font-style: italic\">//2us\t\t//@12.000MHz</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #C792EA\">unsigned</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">char</span><span style=\"color: #F07178\"> i</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> j</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #82AAFF\">_nop_</span><span style=\"color: #89DDFF\">();</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    i </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    j </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">255</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF; font-style: italic\">do</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">        </span><span style=\"color: #89DDFF; font-style: italic\">while</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">(--</span><span style=\"color: #F07178\">j</span><span style=\"color: #89DDFF\">);</span><span style=\"color: #676E95; font-style: italic\">//2*255-1=509us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF; font-style: italic\">while</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">(--</span><span style=\"color: #F07178\">i</span><span style=\"color: #89DDFF\">);</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #676E95; font-style: italic\">//2us</span></span></code></pre></div><div class=\"language-c\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">c</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #292D3E\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">void</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">Delay520us</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #676E95; font-style: italic\">//2us\t\t//@12.000MHz</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #C792EA\">unsigned</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">char</span><span style=\"color: #F07178\"> i</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> j</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    i </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    j </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF; font-style: italic\">do</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #676E95; font-style: italic\">               //刚开始j=0,0--溢出为255，然后从255开始减，越等于从256开始减</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">        </span><span style=\"color: #89DDFF; font-style: italic\">while</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">(--</span><span style=\"color: #F07178\">j</span><span style=\"color: #89DDFF\">);</span><span style=\"color: #676E95; font-style: italic\">//2*256-1=511us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF; font-style: italic\">while</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">(--</span><span style=\"color: #F07178\">i</span><span style=\"color: #89DDFF\">);</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #676E95; font-style: italic\">//2us</span></span></code></pre></div><div class=\"language-c\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">c</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #292D3E\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">void</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">Delay522us</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #676E95; font-style: italic\">//2us\t//522us和524us延时函数一样有误差，加起来为523us @12.000MHz</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #C792EA\">unsigned</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">char</span><span style=\"color: #F07178\"> i</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> j</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    i </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    j </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF; font-style: italic\">do</span><span style=\"color: #676E95; font-style: italic\">//i=2，运行两边2*1=2us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #676E95; font-style: italic\">               //先再1开始执行一遍用1us，执行第一遍的时候1-到0了</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">        </span><span style=\"color: #89DDFF; font-style: italic\">while</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">(--</span><span style=\"color: #F07178\">j</span><span style=\"color: #89DDFF\">);</span><span style=\"color: #676E95; font-style: italic\">//第二遍先空指令然后0到255，再从255开始减，约等于从256开始2*256-1=511us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF; font-style: italic\">while</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">(--</span><span style=\"color: #F07178\">i</span><span style=\"color: #89DDFF\">);</span><span style=\"color: #676E95; font-style: italic\">//第一遍2到1执行空程序然后在执行一遍，第二遍1到0不再往后执行了，2*2-1=3us</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #676E95; font-style: italic\">//2us</span></span></code></pre></div><div class=\"language-c\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">c</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #292D3E\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">void</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">Delay526us</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #676E95; font-style: italic\">//2us\t\t//@12.000MHz</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #C792EA\">unsigned</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">char</span><span style=\"color: #F07178\"> i</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> j</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    i </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    j </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF; font-style: italic\">do</span><span style=\"color: #676E95; font-style: italic\">//i=2，运行两边2*1=2us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #676E95; font-style: italic\">               //第一遍从2开始 2*2-1=3us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">        </span><span style=\"color: #89DDFF; font-style: italic\">while</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">(--</span><span style=\"color: #F07178\">j</span><span style=\"color: #89DDFF\">);</span><span style=\"color: #676E95; font-style: italic\">//第二遍约等于从256开始2*256-1=511us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF; font-style: italic\">while</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">(--</span><span style=\"color: #F07178\">i</span><span style=\"color: #89DDFF\">);</span><span style=\"color: #676E95; font-style: italic\">//第一遍2到1执行空程序然后在执行一遍，第二遍1到0不再往后执行了，3us</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #676E95; font-style: italic\">//2us</span></span></code></pre></div><div class=\"language-c\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">c</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #292D3E\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">void</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">Delay1ms</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #676E95; font-style: italic\">//2us\t\t//@12.000MHz</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #C792EA\">unsigned</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">char</span><span style=\"color: #F07178\"> i</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> j</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    i </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    j </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">239</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF; font-style: italic\">do</span><span style=\"color: #676E95; font-style: italic\">//i=2，运行两边2*1=2us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #676E95; font-style: italic\">               //第一遍从239开始2*239-1=477us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">        </span><span style=\"color: #89DDFF; font-style: italic\">while</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">(--</span><span style=\"color: #F07178\">j</span><span style=\"color: #89DDFF\">);</span><span style=\"color: #676E95; font-style: italic\">//第二遍约等于从256开始2*256-1=511us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF; font-style: italic\">while</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">(--</span><span style=\"color: #F07178\">i</span><span style=\"color: #89DDFF\">);</span><span style=\"color: #676E95; font-style: italic\">//第一遍2到1执行空程序然后在执行一遍，第二遍1到0不再往后执行了，3us</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #676E95; font-style: italic\">//2us</span></span></code></pre></div><div class=\"language-c\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">c</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #292D3E\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">void</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">Delay1040us</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #676E95; font-style: italic\">//2us\t\t//@12.000MHz</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #C792EA\">unsigned</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">char</span><span style=\"color: #F07178\"> i</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> j</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    i </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    j </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF; font-style: italic\">do</span><span style=\"color: #676E95; font-style: italic\">//3*1=3us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #676E95; font-style: italic\">               //第一遍从2开始2*(2-1)+1=3us，第二遍第三遍从256开始2*2*(256-1)+1=1022us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">        </span><span style=\"color: #89DDFF; font-style: italic\">while</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">(--</span><span style=\"color: #F07178\">j</span><span style=\"color: #89DDFF\">);</span><span style=\"color: #676E95; font-style: italic\">//1022+3=1025us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF; font-style: italic\">while</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">(--</span><span style=\"color: #F07178\">i</span><span style=\"color: #89DDFF\">);</span><span style=\"color: #676E95; font-style: italic\">//2*(3-1)+1=5us</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #676E95; font-style: italic\">//2us</span></span></code></pre></div><div class=\"language-c\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">c</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #292D3E\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">void</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">Delay132ms</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #676E95; font-style: italic\">//2us\t\t//@12.000MHz</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #C792EA\">unsigned</span><span style=\"color: #F07178\"> </span><span style=\"color: #C792EA\">char</span><span style=\"color: #F07178\"> i</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> j</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> k</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #82AAFF\">_nop_</span><span style=\"color: #89DDFF\">();</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    i </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    j </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    k </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">201</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #676E95; font-style: italic\">//1us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF; font-style: italic\">do</span><span style=\"color: #676E95; font-style: italic\">//i=2，2us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">        </span><span style=\"color: #89DDFF; font-style: italic\">do</span><span style=\"color: #676E95; font-style: italic\">              //第一遍先执行一遍循环do-while-while 1+2*(201-1)+1+1=403us然后i=1了</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">        </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #676E95; font-style: italic\">               //第二遍jk都为0了，从256开始</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">            </span><span style=\"color: #89DDFF; font-style: italic\">while</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">(--</span><span style=\"color: #F07178\">k</span><span style=\"color: #89DDFF\">);</span><span style=\"color: #676E95; font-style: italic\">//k执行一遍需要511us，但是j=256，所以要256*511=130816us do也要执行256遍 +256us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">        </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF; font-style: italic\">while</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">(--</span><span style=\"color: #F07178\">j</span><span style=\"color: #89DDFF\">);</span><span style=\"color: #676E95; font-style: italic\">//2*(256-1)+1=511us</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF; font-style: italic\">while</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">(--</span><span style=\"color: #F07178\">i</span><span style=\"color: #89DDFF\">);</span><span style=\"color: #676E95; font-style: italic\">//2*(2-1)+1=3us</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #676E95; font-style: italic\">//2us</span></span></code></pre></div>","feature":true,"text":"延时函数在单片机运行的代码中，由于我们计算机的速度是很快的，执行每一条代码的速度也是很快的，也就仅有几微秒而已，是我们肉眼观察不到的。根据开发者的需求，有时候我...","permalink":"/post/基于51单片机的C语言延时函数","photos":[],"count_time":{"symbolsCount":"4.1k","symbolsTime":"4 mins."},"categories":[{"name":"51单片机","slug":"51单片机","count":7,"path":"api/categories/51单片机.json"}],"tags":[{"name":"电子","slug":"电子","count":8,"path":"api/tags/电子.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%BB%B6%E6%97%B6%E5%87%BD%E6%95%B0\"><span class=\"toc-text\">延时函数</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%91%A8%E6%9C%9F\"><span class=\"toc-text\">周期</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%97%B6%E9%92%9F%E5%91%A8%E6%9C%9F\"><span class=\"toc-text\">时钟周期</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%8A%B6%E6%80%81%E5%91%A8%E6%9C%9F\"><span class=\"toc-text\">状态周期</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%8C%87%E4%BB%A4%E5%91%A8%E6%9C%9F\"><span class=\"toc-text\">指令周期</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9C%BA%E5%99%A8%E5%91%A8%E6%9C%9F\"><span class=\"toc-text\">机器周期</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AF%B9%E4%BA%8E%E7%A8%8B%E5%BA%8F%E5%8F%96%E5%80%BC%E7%9A%84%E7%90%86%E8%A7%A3\"><span class=\"toc-text\">对于程序取值的理解</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%A9%E7%94%A8for%E8%AF%AD%E5%8F%A5\"><span class=\"toc-text\">利用for语句</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#while%E5%92%8Cdo-while\"><span class=\"toc-text\">while和do-while</span></a></li></ol></li></ol></li></ol>","author":{"name":"Ed-RYan","slug":"blog-author","avatar":"https://picdl.sunbangyan.cn/2024/01/27/b3236412f4a1762b08031ab7af587235.webp","link":"/","description":"想暂停时间 <br /> @ <b>淼淼淼淼淼淼淼</b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"QQ":{"icon":"iconfont icon-tengxunQQ","link":"https://picdl.sunbangyan.cn/2024/01/21/8f2f70af10b4f0d5d6f32559116ba096.jpeg"},"Bilibili":{"icon":"iconfont icon-bilibili","link":"https://space.bilibili.com/142342578?spm_id_from=333.1007.0.0"},"Wechat":{"icon":"iconfont icon-weixin","link":"https://picdl.sunbangyan.cn/2024/01/21/42a74c77817f8c7588ebeedffd7e94e3.jpeg"},"WechatPay":{"icon":"iconfont icon-weixinzhifu","link":"https://picss.sunbangyan.cn/2024/01/21/42669be5c178707607662c75477734a8.jpeg"}}}},"mapped":true,"hidden":false,"prev_post":{"title":"中断","uid":"87122f1313843578dbea5a21e7a0d4c1","slug":"中断","date":"2024-03-18T11:32:14.000Z","updated":"2024-03-18T11:32:14.886Z","comments":true,"path":"api/articles/中断.json","keywords":null,"cover":null,"text":"","permalink":"/post/中断","photos":[],"count_time":{"symbolsCount":0,"symbolsTime":"1 mins."},"categories":[],"tags":[],"author":{"name":"Ed-RYan","slug":"blog-author","avatar":"https://picdl.sunbangyan.cn/2024/01/27/b3236412f4a1762b08031ab7af587235.webp","link":"/","description":"想暂停时间 <br /> @ <b>淼淼淼淼淼淼淼</b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"QQ":{"icon":"iconfont icon-tengxunQQ","link":"https://picdl.sunbangyan.cn/2024/01/21/8f2f70af10b4f0d5d6f32559116ba096.jpeg"},"Bilibili":{"icon":"iconfont icon-bilibili","link":"https://space.bilibili.com/142342578?spm_id_from=333.1007.0.0"},"Wechat":{"icon":"iconfont icon-weixin","link":"https://picdl.sunbangyan.cn/2024/01/21/42a74c77817f8c7588ebeedffd7e94e3.jpeg"},"WechatPay":{"icon":"iconfont icon-weixinzhifu","link":"https://picss.sunbangyan.cn/2024/01/21/42669be5c178707607662c75477734a8.jpeg"}}}},"feature":true},"next_post":{"title":"51单片机原理及应用","uid":"0c7c5c12646ceac7713a737866b0b523","slug":"51单片机基础","date":"2024-02-27T15:18:00.000Z","updated":"2024-03-15T10:08:10.114Z","comments":true,"path":"api/articles/51单片机基础.json","keywords":null,"cover":"https://picdm.sunbangyan.cn/2024/02/27/82daa9f37704b8d40e4ed39570079d0e.jpeg","text":"51 单片机原理及应用第一章 51 单片机基础知识单片机的发展及概述微机、微处理器、单片机概念从使用角度来讲，计算机可以分为 广泛的通用计算机系统 ** 和 *...","permalink":"/post/51单片机基础","photos":[],"count_time":{"symbolsCount":"7.6k","symbolsTime":"7 mins."},"categories":[{"name":"51单片机","slug":"51单片机","count":7,"path":"api/categories/51单片机.json"}],"tags":[{"name":"电子","slug":"电子","count":8,"path":"api/tags/电子.json"}],"author":{"name":"Ed-RYan","slug":"blog-author","avatar":"https://picdl.sunbangyan.cn/2024/01/27/b3236412f4a1762b08031ab7af587235.webp","link":"/","description":"想暂停时间 <br /> @ <b>淼淼淼淼淼淼淼</b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"QQ":{"icon":"iconfont icon-tengxunQQ","link":"https://picdl.sunbangyan.cn/2024/01/21/8f2f70af10b4f0d5d6f32559116ba096.jpeg"},"Bilibili":{"icon":"iconfont icon-bilibili","link":"https://space.bilibili.com/142342578?spm_id_from=333.1007.0.0"},"Wechat":{"icon":"iconfont icon-weixin","link":"https://picdl.sunbangyan.cn/2024/01/21/42a74c77817f8c7588ebeedffd7e94e3.jpeg"},"WechatPay":{"icon":"iconfont icon-weixinzhifu","link":"https://picss.sunbangyan.cn/2024/01/21/42669be5c178707607662c75477734a8.jpeg"}}}},"feature":true}}